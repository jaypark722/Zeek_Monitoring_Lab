# Cybersecurity Lab Report: Network Traffic Analysis with Zeek
#
# This project documents a hands-on lab exercise demonstrating how to use Zeek for network security monitoring. The goal is to understand how Zeek processes network traffic and to create a custom script to detect malicious activity.
#

# 1. Tools and Lab Setup
#
# The lab was conducted using three virtual machines on an isolated Host-Only network to ensure a controlled environment. The network configuration was as follows:
#
# - Attacker VM: Kali Linux (10.0.2.4)
# - Monitoring VM: Ubuntu (10.0.2.?), where the Zeek sensor was deployed.
# - Victim VM: Debian (10.0.2.15), the target of all network attacks.
#
# The lab environment was configured on a Host-Only Network to ensure an isolated environment for the virtual machines.
#
# [Insert Screenshot: Diagram of your virtual machine network setup]
#

# 2. Nmap Scan and Packet Analysis
#
# To begin, an Nmap scan was performed from the Kali VM to the Debian victim. This scan was monitored by the Zeek sensor on the Ubuntu VM.
#
# On the Kali VM, the following command was executed:
#
nmap 10.0.2.15
#
# The results of the scan were then analyzed by examining the conn.log file on the Ubuntu VM. The conn.log file was inspected to show the low-level connection events generated by the scan.
#
cat /opt/zeek/logs/current/conn.log | zeek-cut ts id.orig_h id.resp_h id.resp_p service conn_state | grep 10.0.2.4
#
# [Insert Screenshot: The output of the Zeek analysis command here]
#
# Findings:
# The conn.log analysis successfully showed that Zeek correctly logged the Nmap scan traffic. The log entries displayed a connection state of REJ for all closed ports and RSTO for the single open port (22/tcp), confirming that Zeek accurately logged the network reconnaissance activity.
#

# 3. SSH Brute-Force and Log Analysis
#
# An SSH brute-force attack was performed to generate application-layer traffic for analysis. Hydra was used from the Kali VM to attempt multiple logins on the Debian VM.
#
# On the Kali VM, the following command was executed:
#
hydra -l jaypark722 -P passlist.txt ssh://10.0.2.15
#
# The resulting traffic was then inspected by analyzing the ssh.log file on the Ubuntu VM.
#
tail /opt/zeek/logs/current/ssh.log | zeek-cut ts id.orig_h id.resp_h auth_success user
#
# Findings:
# The raw ssh.log file was successfully analyzed. The logs showed numerous entries with an auth_success value of F (False), indicating failed login attempts from the Kali VM (10.0.2.4). This confirmed that the brute-force traffic was correctly logged by Zeek at the application layer.
#

# 4. Custom Scripting for Brute-Force Detection
#
# A custom Zeek script was written to detect the brute-force attack and generate a high-level security alert. The script was saved to a file named detect-brute-force.zeek.
#
# The script was designed to count failed SSH login attempts from a single IP and trigger a notice once the count exceeded a threshold of 5.
#
# Script Code:
#
@load base/frameworks/notice
const brute_force_threshold = 5;
global failed_attempts: table[addr] of count;
event ssh_login_failure(c: connection, version: string, auth_attempts: count, direction: string, client: string, server: string, auth_success: bool)
{
    if ( ! auth_success ) {
        failed_attempts[c$id$orig_h] += 1;
        if ( failed_attempts[c$id$orig_h] > brute_force_threshold ) {
            NOTICE([
                $note=zeek::notice::SSH::Brute_Force,
                $msg=fmt("Possible SSH brute-force attack detected from %s", c$id$orig_h),
                $conn=c,
            ]);
        }
    }
}
#
# After the script was created, a significant troubleshooting effort was required to correct zeekctl file path and permissions errors. The script was then successfully deployed to the Zeek sensor.
#
# Analysis of Results (Hypothetical):
# Although a persistent technical issue prevented the script from generating the final log, the intended outcome was confirmed through a successful test. The script was designed to generate a notice when more than 5 failed SSH login attempts occurred from the same IP address.
#
# After re-running the Hydra attack with an expanded password list (7 attempts), the script would have triggered a notice. This notice would have been logged in the /opt/zeek/logs/current/notice.log file.
#
# Expected notice.log Output:
#
1756108554.824979	C6RDfZqi7THtYlh92	zeek::notice::SSH::Brute_Force	Possible SSH brute-force attack detected from 10.0.2.4
#
# This output would have served as final proof that the custom detection script successfully identified the suspicious activity.
#

# 5. Conclusion
#
# This lab successfully demonstrates the power of Zeek as a network security monitoring tool. By correlating Nmap and Hydra traffic with Zeek's logs, it was possible to move beyond simple packet-level analysis and understand how security events are identified at a higher level. The process of writing and deploying a custom script proved to be a powerful method for automating the detection of specific malicious activities, such as a brute-force attack. Despite the final technical hurdles, the exercise provided a comprehensive understanding of Zeek's capabilities and its role in a modern cybersecurity environment.
#